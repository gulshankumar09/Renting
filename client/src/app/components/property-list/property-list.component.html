<div class="container">
  <h1 class="section-title">Browse Properties</h1>

  <div class="filters-container">
    <form [formGroup]="filterForm">
      <div class="filters-grid">
        <mat-form-field appearance="outline">
          <mat-label>Location</mat-label>
          <input
            matInput
            formControlName="location"
            placeholder="City, area, or street"
          />
          <mat-icon matSuffix>location_on</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Property Type</mat-label>
          <mat-select formControlName="propertyType">
            <mat-option *ngFor="let type of propertyTypes" [value]="type.value">
              {{ type.display }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Min Price</mat-label>
          <input
            matInput
            formControlName="minPrice"
            type="number"
            placeholder="0"
          />
          <span matTextPrefix>$</span>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Max Price</mat-label>
          <input
            matInput
            formControlName="maxPrice"
            type="number"
            placeholder="Any"
          />
          <span matTextPrefix>$</span>
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          *ngIf="filterForm.get('propertyType')?.value !== 'Hotel'"
        >
          <mat-label>Bedrooms</mat-label>
          <mat-select formControlName="bedrooms">
            <mat-option value="">Any</mat-option>
            <mat-option value="1">1</mat-option>
            <mat-option value="2">2</mat-option>
            <mat-option value="3">3</mat-option>
            <mat-option value="4">4+</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="resetFilters()">
          Reset Filters
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading properties...</p>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error" class="property-results">
    <p class="results-count">
      {{ filteredProperties.length }} properties found
    </p>

    <div class="property-grid">
      <mat-card
        *ngFor="let property of filteredProperties"
        class="property-card"
      >
        <img
          mat-card-image
          [src]="
            property.imageUrls && property.imageUrls.length
              ? property.imageUrls[0]
              : 'assets/placeholder.jpg'
          "
          alt="{{ property.title }}"
        />
        <mat-card-content>
          <div class="property-type">{{ property.type }}</div>
          <h3>{{ property.title }}</h3>
          <p class="location">
            <mat-icon>location_on</mat-icon> {{ property.location }}
          </p>
          <p class="price">
            ${{ property.price }}
            <span *ngIf="property.type !== 'Hotel'">/month</span
            ><span *ngIf="property.type === 'Hotel'">/night</span>
          </p>
          <div class="property-features" *ngIf="property.type !== 'Hotel'">
            <span><mat-icon>hotel</mat-icon> {{ property.bedrooms }} Beds</span>
            <span
              ><mat-icon>bathtub</mat-icon> {{ property.bathrooms }} Baths</span
            >
            <span
              ><mat-icon>square_foot</mat-icon> {{ property.area }} sq ft</span
            >
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button
            mat-button
            color="primary"
            [routerLink]="['/properties', property.id]"
          >
            View Details
          </button>
          <button mat-stroked-button color="primary">
            <mat-icon>favorite_border</mat-icon> Save
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <div *ngIf="filteredProperties.length === 0" class="no-properties">
      <p>
        No properties match your search criteria. Try adjusting your filters.
      </p>
      <button mat-raised-button color="primary" (click)="resetFilters()">
        Reset Filters
      </button>
    </div>
  </div>
</div>
